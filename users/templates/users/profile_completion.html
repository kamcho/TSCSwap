{% extends 'users/base.html' %}

{% block title %}Complete Your Profile - TSC Swap{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">Complete Your Profile</h1>
            <p class="text-gray-300">We just need a few more details to get started</p>
        </div>

        <div class="bg-gray-800/70 rounded-2xl shadow-xl border border-gray-700 p-8 backdrop-blur-sm">
            <form method="post" id="profileForm">
                {% csrf_token %}
                
                <div class="space-y-6">
                    <div class="space-y-2">
                        <label for="id_number" class="block text-sm font-medium text-gray-300">
                            National ID Number
                        </label>
                        <input type="text" 
                               id="id_number" 
                               name="id_number" 
                               value="{{ id_number|default:'' }}"
                               required
                               class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent transition duration-200 text-white placeholder-gray-400"
                               placeholder="Enter your ID number">
                    </div>
                    
                    <div class="space-y-2">
                        <label for="first_name" class="block text-sm font-medium text-gray-300">
                            First Name
                        </label>
                        <input type="text" 
                               id="first_name" 
                               name="first_name" 
                               value="{{ first_name|default:'' }}"
                               required
                               class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent transition duration-200 text-white placeholder-gray-400"
                               placeholder="Enter your first name">
                    </div>
                    
                    <div class="pt-2">
                        <button type="submit" 
                                class="w-full bg-gradient-to-r from-teal-600 to-blue-600 text-white py-3 px-4 rounded-lg hover:from-teal-700 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:-translate-y-0.5">
                            Verify with TSC Records
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- Verification Modal -->
            {% if show_verification_modal %}
            <div id="verificationModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                <div class="bg-gray-800 border border-gray-700 rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Verification Successful</h3>
                        <p class="text-gray-300 mb-6">We've verified your details with TSC</p>
                        
                        <div class="bg-gray-700/50 p-4 rounded-xl mb-6 text-left border border-gray-600/50">
                            <div class="flex justify-between py-2 border-b border-gray-600/50">
                                <span class="font-medium text-gray-300">Full Name:</span>
                                <span class="text-white font-medium">{{ kra_data.name }}</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="font-medium text-gray-300">ID Number:</span>
                                <span class="text-white font-medium">{{ kra_data.id_number }}</span>
                            </div>
                        </div>
                        
                        <form method="post" id="verifyForm">
                            {% csrf_token %}
                            <input type="hidden" name="verify_kra" value="true">
                            <input type="hidden" name="id_number" value="{{ id_number }}">
                            <input type="hidden" name="first_name" value="{{ first_name }}">
                            
                            <button type="submit" 
                                    class="w-full bg-gradient-to-r from-teal-600 to-blue-600 text-white py-3 px-4 rounded-lg hover:from-teal-700 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:-translate-y-0.5 mb-3">
                                Save and Continue
                            </button>
                            <button type="button" 
                                    onclick="document.getElementById('verificationModal').classList.add('hidden')" 
                                    class="w-full bg-gray-700/50 border border-gray-600 text-gray-200 py-3 px-4 rounded-lg hover:bg-gray-600/50 transition duration-200">
                                Cancel
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <script>
                // Show modal when page loads
                document.addEventListener('DOMContentLoaded', function() {
                    document.getElementById('verificationModal').classList.remove('hidden');
                });
            </script>
            {% endif %}
            
            <script>
                // Handle form submission
                document.getElementById('profileForm').addEventListener('submit', function(e) {
                    // Form will submit normally - server will handle verification
                });
            </script>
        </div>
        
        <!-- Skip Option -->
        <div class="text-center mt-6">
            <a href="{% url 'home:home' %}" class="inline-flex items-center text-gray-400 hover:text-teal-400 transition-colors duration-200">
                <span>Skip for now</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </a>
        </div>
    </div>
</div>

<style>
    .county-dropdown {
        position: relative;
    }
    
    .county-list {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        z-index: 10;
        margin-top: 0.5rem;
        background: #1f2937;
        border: 1px solid #374151;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        max-height: 300px;
        overflow-y: auto;
    }
    
    .county-list.show {
        display: block;
    }
    
    .county-search {
        width: 100%;
        padding: 0.75rem 1rem;
        background: #374151;
        border: none;
        border-bottom: 1px solid #4b5563;
        color: white;
        border-radius: 0.5rem 0.5rem 0 0;
    }
    
    .county-search:focus {
        outline: none;
        background: #3e4c5e;
    }
    
    .county-options {
        max-height: 250px;
        overflow-y: auto;
    }
    
    .county-item {
        padding: 0.75rem 1rem;
        color: #e5e7eb;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .county-item:hover {
        background: #374151;
        color: #ffffff;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const counties = [
        'Mombasa', 'Kwale', 'Kilifi', 'Tana River', 'Lamu', 'Taita Taveta', 'Garissa', 'Wajir', 
        'Mandera', 'Marsabit', 'Isiolo', 'Meru', 'Tharaka Nithi', 'Embu', 'Kitui', 'Machakos', 
        'Makueni', 'Nyandarua', 'Nyeri', 'Kirinyaga', 'Murang\'a', 'Kiambu', 'Turkana', 
        'West Pokot', 'Samburu', 'Trans Nzoia', 'Uasin Gishu', 'Elgeyo Marakwet', 'Nandi', 
        'Baringo', 'Laikipia', 'Nakuru', 'Narok', 'Kajiado', 'Kericho', 'Bomet', 'Kakamega', 
        'Vihiga', 'Bungoma', 'Busia', 'Siaya', 'Kisumu', 'Homa Bay', 'Migori', 'Kisii', 
        'Nyamira', 'Nairobi'
    ];
    
    const locationInput = document.getElementById('location');
    const countyList = document.getElementById('countyList');
    const countySearch = document.getElementById('countySearch');
    const countyOptions = document.getElementById('countyOptions');
    
    // Populate counties
    function populateCounties(filteredCounties = counties) {
        countyOptions.innerHTML = '';
        if (filteredCounties.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'county-item text-gray-400 italic';
            noResults.textContent = 'No matching counties found';
            countyOptions.appendChild(noResults);
            return;
        }
        
        filteredCounties.forEach(county => {
            const div = document.createElement('div');
            div.className = 'county-item';
            div.textContent = county;
            div.addEventListener('click', function() {
                locationInput.value = county;
                countyList.classList.remove('show');
            });
            countyOptions.appendChild(div);
        });
    }
    
    // Show dropdown
    if (locationInput) {
        locationInput.addEventListener('click', function(e) {
            e.stopPropagation();
            countyList.classList.add('show');
            countySearch.focus();
        });
    }
    
    // Search functionality
    if (countySearch) {
        countySearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filtered = counties.filter(county => 
                county.toLowerCase().includes(searchTerm)
            );
            populateCounties(filtered);
        });
    }
    
    // Hide dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.county-dropdown')) {
            countyList.classList.remove('show');
        }
    });
    
    // Close dropdown on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            countyList.classList.remove('show');
        }
    });
    
    // Initial population
    if (countyOptions) {
        populateCounties();
    }
});
</script>
{% endblock %} 